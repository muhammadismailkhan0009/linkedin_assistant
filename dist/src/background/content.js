(()=>{class e{async getAuthToken(){return new Promise(e=>{chrome.storage.local.get(["token"],t=>{e(t.token??null)})})}async getInstallId(){return new Promise(e=>{chrome.storage.local.get(["installId"],t=>{e(t.installId??null)})})}async generatePost(e){try{let t=await this.getAuthTokenAndInstallerId(),n=await fetch("https://api.wanderlytics.me/linkedin/api/v1/create-post",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`},body:JSON.stringify({payload:{idea:e},additionalMetadata:{installId:t.installId}})});if(!n.ok)throw Error(`Backend error: ${n.status}`);let a=await n.json();return console.log("✅ post received from backend:",a),a}catch(e){return console.error("❌ Failed to send post to backend:",e),null}}async getAuthTokenAndInstallerId(){let e=await this.getAuthToken(),t=await this.getInstallId();if(!e||!t)throw Error("Missing auth token or install ID");return{token:e,installId:t}}async sendPostToBackend(e,t){try{let n=await this.getAuthTokenAndInstallerId(),a=await fetch("https://api.wanderlytics.me/linkedin/api/v1/create-comment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.token}`},body:JSON.stringify({payload:{scrappedPost:e,url:t},additionalMetadata:{installId:n.installId}})});if(!a.ok)throw Error(`Backend error: ${a.status}`);let o=await a.json();return console.log("✅ Comment received from backend:",o),o}catch(e){return console.error("❌ Failed to send post to backend:",e),null}}async sendTracingData(e){try{let t=await this.getAuthTokenAndInstallerId(),n=await fetch("https://api.wanderlytics.me/linkedin/api/v1/tracing-data",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.token}`},body:JSON.stringify({payload:e,additionalMetadata:{installId:t.installId}})});if(!n.ok)throw Error(`Backend error: ${n.status}`);let a=await n.json();return console.log("✅ Comment received from backend:",a),a}catch(e){return console.error("❌ Failed to send post to backend:",e),null}}}async function t(){console.log("⏳ [Scraper] Waiting for DOM to load..."),"loading"===document.readyState?(await new Promise(e=>document.addEventListener("DOMContentLoaded",e)),console.log("✅ [Scraper] DOM fully loaded.")):console.log("✅ [Scraper] DOM was already ready.");let e=await function(e,t=1e4){return new Promise(n=>{let a=Date.now(),o=setInterval(()=>{let r=Date.now()-a,l=document.querySelector(e);l&&(console.log("✅ [Scraper] Found post text element."),clearInterval(o),n(l.innerText.trim())),r>=t&&(console.warn("⚠️ [Scraper] Timeout: Post text not found."),clearInterval(o),n(null))},500)})}('.update-components-update-v2__commentary span[dir="ltr"]');if(e)return e;throw console.error("❌ [Scraper] Failed to find or extract post text."),Error("post could not be extracted")}async function n(e,t){if(!t)return;let n=`comment-${t}`;await chrome.storage.local.set({[n]:e}),console.log("comment stored:"+e)}var a=function(e){return e.POST="POST",e.COMMENT="COMMENT",e}({}),o=function(e){return e.GENERATED="GENERATED",e.COPIED="COPIED",e}({});async function r(){chrome.runtime.sendMessage({type:"SET_BADGE",status:"loading"});let r=window.location.href,l=await t(),i=await new e().sendPostToBackend(l,"");n(i.payload,r),chrome.runtime.sendMessage({type:"SET_BADGE",status:"ready"}),function(t,n,a){console.log(n);let r={inputContent:t,generatedContent:n,type:a,eventType:o.GENERATED,timeStamp:new Date};new e().sendTracingData(r)}(l,i.payload,a.COMMENT)}console.log("✅ [LinkedIn Scraper] Content script injected."),r()})();
//# sourceMappingURL=content.js.map
