(()=>{let e="http:localhost:8111";class t{async getAuthToken(){return new Promise(e=>{chrome.storage.local.get(["token"],t=>{e(t.token??null)})})}async getInstallId(){return new Promise(e=>{chrome.storage.local.get(["installId"],t=>{e(t.installId??null)})})}async generatePost(t){try{let n=await this.getAuthTokenAndInstallerId(),o=await fetch(e+"/linkedin/api/v1/create-post",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.token}`},body:JSON.stringify({payload:{idea:t},additionalMetadata:{installId:n.installId}})});if(!o.ok)throw Error(`Backend error: ${o.status}`);let r=await o.json();return console.log("✅ post received from backend:",r),r}catch(e){return console.error("❌ Failed to send post to backend:",e),null}}async getAuthTokenAndInstallerId(){let e=await this.getAuthToken(),t=await this.getInstallId();if(!e||!t)throw Error("Missing auth token or install ID");return{token:e,installId:t}}async sendPostToBackend(t,n){try{let o=await this.getAuthTokenAndInstallerId(),r=await fetch(e+"/linkedin/api/v1/create-comment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.token}`},body:JSON.stringify({payload:{scrappedPost:t,url:n},additionalMetadata:{installId:o.installId}})});if(!r.ok)throw Error(`Backend error: ${r.status}`);let a=await r.json();return console.log("✅ Comment received from backend:",a),a}catch(e){return console.error("❌ Failed to send post to backend:",e),null}}async sendJourneyInfo(t){try{let n=await this.getAuthTokenAndInstallerId(),o=await fetch(e+"/linkedin/api/v1/journey",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.token}`},body:JSON.stringify({payload:t,additionalMetadata:{installId:n.installId}})});if(!o.ok)throw Error(`Backend error: ${o.status}`);let r=await o.json();return console.log("✅ journey info sent to backend:",r),r}catch(e){return console.error("❌ Failed to send journey info to backend:",e),null}}async sendJourneyStepInfo(t){try{let n=await this.getAuthTokenAndInstallerId(),o=await fetch(e+"/linkedin/api/v1/journey/step",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.token}`},body:JSON.stringify({payload:t,additionalMetadata:{installId:n.installId}})});if(!o.ok)throw Error(`Backend error: ${o.status}`);let r=await o.json();return console.log("✅ step info sent to backend:",r),r}catch(e){return console.error("❌ Failed to send step info to backend:",e),null}}}async function n(){console.log("⏳ [Scraper] Waiting for DOM to load..."),"loading"===document.readyState?(await new Promise(e=>document.addEventListener("DOMContentLoaded",e)),console.log("✅ [Scraper] DOM fully loaded.")):console.log("✅ [Scraper] DOM was already ready.");let e=await function(e,t=1e4){return new Promise(n=>{let o=Date.now(),r=setInterval(()=>{let a=Date.now()-o,s=document.querySelector(e);s&&(console.log("✅ [Scraper] Found post text element."),clearInterval(r),n(s.innerText.trim())),a>=t&&(console.warn("⚠️ [Scraper] Timeout: Post text not found."),clearInterval(r),n(null))},500)})}('.update-components-update-v2__commentary span[dir="ltr"]');if(e)return e;throw console.error("❌ [Scraper] Failed to find or extract post text."),Error("post could not be extracted")}async function o(e,t){if(!t)return;let n=`comment-${t}`;await chrome.storage.local.set({[n]:e}),console.log("comment stored:"+e)}var r=function(e){return e.COMMENT_CREATION="COMMENT_CREATION",e.POST_CREATION="POST_CREATION",e}({});async function a(e,t){let n=new TextEncoder,o=await crypto.subtle.importKey("raw",n.encode(e),{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return[...new Uint8Array(await crypto.subtle.sign("HMAC",o,n.encode(t)))].map(e=>e.toString(16).padStart(2,"0")).join("")}async function s(e){let t=crypto.randomUUID(),n=await a("your-very-secret-key",t);e===r.COMMENT_CREATION?chrome.storage.local.set({commentCreationJourney:n},()=>{console.log("Comment creation token generated and saved:",n)}):e===r.POST_CREATION&&chrome.storage.local.set({postCreationJourney:n},()=>{console.log("post creatin token generated and saved:",n)})}async function l(e){return e===r.COMMENT_CREATION?new Promise(e=>{chrome.storage.local.get(["commentCreationJourney"],t=>{e(t.commentCreationJourney??null)})}):e===r.POST_CREATION?new Promise(e=>{chrome.storage.local.get(["postCreationJourney"],t=>{e(t.postCreationJourney??null)})}):""}var i=function(e){return e.START="START",e.END="END",e}({});let d=new t,c={startJourney(e){let t={journeyId:e,journeyType:r.COMMENT_CREATION,status:i.START};d.sendJourneyInfo(t)},endJourney(e){let t={journeyId:e,journeyType:r.COMMENT_CREATION,status:i.END};d.sendJourneyInfo(t)}};var u=function(e){return e.GENERATED="GENERATED",e.COPIED="COPIED",e.POSTED="POSTED",e}({}),p=function(e){return e.POST="POST",e.COMMENT="COMMENT",e}({});let y=new t,m={generated(e){let t={journeyId:e.journeyId,stepNumber:1,stepType:u.GENERATED,contentType:p.COMMENT,inputContent:e.inputContent,outputContent:e.outputContent};y.sendJourneyStepInfo(t),console.log("comment generated step sent")},copied(e){let t={journeyId:e.journeyId,stepNumber:2,stepType:u.COPIED,contentType:p.COMMENT,inputContent:e.inputContent,outputContent:e.outputContent};y.sendJourneyStepInfo(t),console.log("comment copied step sent")},posted(e){let t={journeyId:e.journeyId,stepNumber:3,stepType:u.POSTED,contentType:p.COMMENT,inputContent:e.inputContent,outputContent:e.outputContent};y.sendJourneyStepInfo(t),console.log("comment post event ran"),console.log("comment posted step sent:",e.outputContent)}};async function T(){await s(r.COMMENT_CREATION);let e=await l(r.COMMENT_CREATION);console.log("journey_id_at_start:",e),c.startJourney(e),chrome.runtime.sendMessage({type:"SET_BADGE",status:"loading"});let a=window.location.href,i=await n(),d=await new t().sendPostToBackend(i,"");o(d.payload,a),chrome.runtime.sendMessage({type:"SET_BADGE",status:"ready"});let u={journeyId:e,inputContent:i,outputContent:d.payload};m.generated(u),document.addEventListener("click",e=>{let t=e.target.closest("button.comments-comment-box__submit-button--cr");if(!t)return;let n=t.closest("div.comments-comment-box--cr");if(!n)return;let o=n.querySelector("div.ql-editor");if(!o)return;let r=o.innerText.trim();if(!r)return;let a=new CustomEvent("CommentPostedEvent",{detail:{finalContent:r}});document.dispatchEvent(a)}),document.addEventListener("CommentPostedEvent",t=>{let{finalContent:n}=t.detail,o={journeyId:e,inputContent:d.payload,outputContent:n};m.posted(o),c.endJourney(e)})}console.log("✅ [LinkedIn Scraper] Content script injected."),T()})();
//# sourceMappingURL=content.js.map
